<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>Character Sheet</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>
    
<body>
  <top>
      <name id=charname>
      </name><br>
      <info id=info>
      <inforow1 id=inforow1>
        <classdiv id=classdiv></classdiv>
        <leveldiv id=leveldiv></leveldiv>
        <backgrounddiv id=backgrounddiv></backgrounddiv>
        <playernamediv id=playernamediv></playernamediv>
      </inforow1>
      <inforow2 id=inforow2>
        <racediv id=racediv></racediv>
        <alignmentdiv id=alignmentdiv></alignmentdiv>
        <experiencepointsdiv id=experiencepointsdiv></experiencepointsdiv>
      </inforow2>
      </info><br>
  </top>
<columns>   
  <col1>
    <subcol1>
      <abilityscores>
          <abilityscore id=abilityscore>
          </abilityscore><br>
      </abilityscores>
    </subcol1>
    <subcol2>
      <inspirationdiv id=inspirationdiv>
      </inspirationdiv>
      <proficiency id=proficiency>
      </proficiency><br>
      <savingthrows id=savingthrows>
          Saving Throws<br>
      </savingthrows><br>
      <skill id=skill>
          Skills<br>
      </skill><br>
    </subcol2> 
  </col1>
  <col2>
     <row1>
      <ACInitSpeed id=ACInitSpeed>
        <ArmorClassDiv id=ArmorClassDiv></ArmorClassDiv>
        <InitiativeDiv id=InitiativeDiv></InitiativeDiv>
        <SpeedDiv id=SpeedDiv></SpeedDiv>
      </ACInitSpeed><br>
      <Hitpoints id=hitpoints>
        <HitPointMaximumDiv id=HitPointMaximumDiv></HitPointMaximumDiv>
        <CurrentHitPointsDiv id=CurrentHitPointsDiv></CurrentHitPointsDiv>
        <TemporaryHitPointsDiv id=TemporaryHitPointsDiv></TemporaryHitPointsDiv>
      </Hitpoints><br>
      <HDandDeath id=HDandDeath>
      <HDDiv>
        <HD>
          <TotalHitdicediv id=TotalHitdicediv></TotalHitdicediv>
          <Hitdicediv id=Hitdicediv></Hitdicediv>
        </HD>
      </HDDiv>
        <DS>
          <successdiv id=successdiv></successdiv>
          <failurediv id=failurediv></failurediv>
        </DS>
      </HDandDeath>
    </row1>
  </col2>
</columns>
  <br><br><br><br><br>
  <button type=button id=downloadbutton>Save File</button><br>
  <input type="file" id="fileInput">
</body>

<script>
//how to use: insert fields into the character variable, and locations for each field in to the locations variable. match via index. each character field NEEDS a location field. script then automatically creates inputs for each character field and assigns them to a div by ID based on the location.
var character = 'CharacterName,Class,Level,Background,PlayerName,Race,Alignment,ExperiencePoints,Strength,Dexterity,Constitution,Intelligence,Wisdom,Charisma,Inspiration,ProficiencyBonus,StrengthSave,DexteritySave,ConstitutionSave,IntelligenceSave,WisdomSave,CharismaSave,Acrobatics,AnimalHandling,Arcana,Athletics,Deception,History,Insight,Intimidation,Investigation,Medicine,Nature,Perception,Performance,Persuasion,Religion,SleightofHand,Stealth,Survival,ArmorClass,Initiative,Speed,HitPointMaximum,CurrentHitPoints,TemporaryHitPoints,TotalHitDice,HitDice,dssuccess1,dssuccess2,dssuccess3,dsfailure1,dsfailure2,dsfailure3'.split(',');
    var locations = 'charname,classdiv,leveldiv,backgrounddiv,playernamediv,racediv,alignmentdiv,experiencepointsdiv,abilityscore,abilityscore,abilityscore,abilityscore,abilityscore,abilityscore,inspirationdiv,proficiency,savingthrows,savingthrows,savingthrows,savingthrows,savingthrows,savingthrows,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,skill,ArmorClassDiv,InitiativeDiv,SpeedDiv,HitPointMaximumDiv,CurrentHitPointsDiv,TemporaryHitPointsDiv,TotalHitdicediv,Hitdicediv,successdiv,successdiv,successdiv,failurediv,failurediv,failurediv'.split(',');
    var label = 'Character Name,Class,Level,Background,Player Name,Race,Alignment,Experience Points,Strength,Dexterity,Constitution,Intelligence,Wisdom,Charisma,Inspiration,Proficiency Bonus,Strength,Dexterity,Constitution,Intelligence,Wisdom,Charisma,Acrobatics (Dex),Animal Handling (Wis),Arcana (Int),Athletics (Str),Deception (Cha),History (Int),Insight (Wis),Intimidation (Cha),Investigation (Int),Medicine (Wis),Nature (Int),Perception (Wis),Performance (Cha),Persuasion (Cha),Religion (Int),Sleight of Hand (Dex),Stealth (Dex),Survival (Wis),Armor Class,Initiative,Speed,Maximum HP,Current HP,Temporary HP,Total,Hit Dice,Successes,,,Failures,,'.split(',');
    var SkillsAndAbilities = {"Athletics":"Strength","Acrobatics":"Dexterity","SleightofHand":"Dexterity","Stealth":"Dexterity","Arcana":"Intelligence","History":"Intelligence","Investigation":"Intelligence","Nature":"Intelligence","Religion":"Intelligence","AnimalHandling":"Wisdom","Insight":"Wisdom","Medicine":"Wisdom","Perception":"Wisdom","Survival":"Wisdom","Deception":"Charisma","Intimidation":"Charisma","Performance":"Charisma","Persuasion":"Charisma"}
    var mods = new Array();
    var loccount = 0; //hack to iterate through locations because [c] wouldn't work for some reason.
    for (var c in character) { //for each index in character, do the following
        var newField = document.createElement('input'); //creates input element in the document
        var loc = locations[loccount]; //gets the location that corresponds to the same index as the current character value
        newField.id = character[c]; //assigns it an ID from character
        newField.className = loc; //assigns classname from location
        newField.placeholder = label[c]; //assigns placeholder text from character
        newField.name = character[c]; //assigns name from character
        loccount++ //iterates loccount
        var elem = document.getElementById(loc); //gets element by matching its ID to the location
        elem.appendChild(newField); //adds the new input field to the location element
        var newlabel=document.createElement("Label");
        var newbr=document.createElement("br");
        newlabel.setAttribute("for",character[c]);
        newlabel.id = character[c] + "label";
        newlabel.className = loc + "label";
        newlabel.innerHTML = label[c];
        if (loc == "abilityscore") {
        		var newmod = document.createElement('input');
            newmod.className = loc + "mod";
            newmod.setAttribute('name', SkillsAndAbilities[character[c]]);
            newmod.id = character[c] + "mod";
            mods.push(character[c] + "mod");
            elem.appendChild(newmod);
            newField.before(newlabel);
            newlabel.before(newbr);
        } else if (loc == "successdiv" || loc == "failurediv") {
        		newField.type = 'checkbox';
            newField.before(newlabel);
        } else if (loc == "skill" || loc == "savingthrows") {
            newField.type = 'checkbox';
            var newmod = document.createElement('input');
            newmod.className = loc + "mod";
            newmod.setAttribute('name', SkillsAndAbilities[character[c]]);
            newmod.id = character[c] + "mod";
            mods.push(character[c] + "mod");
            elem.appendChild(newmod);
            elem.appendChild(newlabel);
            newlabel.appendChild(newbr);
        } else if (loc == "classdiv" || loc == "leveldiv" || loc == "backgrounddiv" || loc == "playernamediv" || loc == "racediv" || loc == "alignmentdiv" || loc == "experiencepointsdiv" || loc == "ArmorClassDiv" || loc == "InitiativeDiv" || loc == "SpeedDiv" || loc == "HitPointMaximumDiv" || loc == "CurrentHitPointsDiv" || loc == "TemporaryHitPointsDiv" || loc == "Hitdicediv") { 
        	  newField.after(newlabel);
            newlabel.before(newbr);
        } else if (loc == "TotalHitdicediv") {
        		newField.before(newlabel);
        } else if (loc == "charname") {} else {
        	newField.before(newlabel);
          newlabel.before(newbr);
        	newField.appendChild(newbr);
          newlabel.appendChild(newbr);
        }
        }

//download button function
document.getElementById("downloadbutton").addEventListener("click", function(){ //adds an event listener to the Download Button, runs function on click.
    var characterfinal = {}; //creates characterfinal object
    for (var d in character) { //for each index in character, do the following
    		prop = character[d]; //assigns current index value from character to the prop variable
        if (document.getElementById(prop).type == "checkbox") {
            elem = document.getElementById(prop).checked;
        } else {elem = document.getElementById(prop).value;} //gets value of element by ID using each field in character object. The elements themselves are created from the character object to begin with, so this will always get all of the fields on the page.
        characterfinal[prop] = elem; //creates key in characterfinal object named from character values, then assigns it a value based on the value of the same field on the page.
    }
    for (var m in mods) {
    	propmod = mods[m];
      elemmod = document.getElementById(propmod).value;
      characterfinal[propmod] = elemmod;
    }
    var text = JSON.stringify(characterfinal, null, 2); //turns the completed characterfinal object into a string for saving, forgot what null does but 2 specifies that it should include line breaks. Assigns it to the text variable, this is printed in the .txt file body.
    var filename = document.getElementById('CharacterName').value; //gets a name for the file from the Character Name field.
    download(text, filename); //calls download function, below, using text and filename options.
}, false); //forgot what this false was for.

//function to actually download the text
function download(text, filename) {
    var element = document.createElement('a'); //creates an element named a 
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text)); //assigns the element the text field and link attributes
    element.setAttribute('download', filename + ".txt"); //adds download attribute with filename and .txt for firefox.
    element.style.display = 'none'; //makes element hidden
    document.body.appendChild(element); //add element to the page
    element.click(); //clicks the element automatically 
    document.body.removeChild(element); //removes the element
}

//upload button function
var fileInput = document.getElementById('fileInput'); //gets fileInput field, aka the upload button
var fileDisplayArea = document.getElementById('CharacterName'); //sets CharacterName to be the filedisplayarea. Just used for error printing.

fileInput.addEventListener('change', function(event) { //checks if the fileInput field is changed, aka if a file is uploaded
    var file = fileInput.files[0]; //gets 1st file from fileInput field
    var textType = /text.*/; //assigns text as filetype var
    if (file.type.match(textType)) { //if filetype matches text, go ahead and load
				var reader = new FileReader(); //creates new FileReader thingy
				reader.onload = function(event) { //when reader loads, do the following
                    for (var e in character) { //for each index of e in character, do the following
                        var field = character[e]; //field is equal to the current index value of the character object
                        var loadedcharacter = JSON.parse(reader.result); //parses the text file back into an object, assigned to loadedcharacter var
                        if (document.getElementById(field).type == "checkbox") {
                            document.getElementById(field).checked = loadedcharacter[field];
                        } else {document.getElementById(field).value = loadedcharacter[field];} //assigns values from the loadedcharacter object to the corresponding elements on the page by their IDs. 
                    }
                    for (var n in mods) {
                    	var fieldmod = mods[n];
                      document.getElementById(fieldmod).value = loadedcharacter[fieldmod];
                    }
				}
    reader.readAsText(file); //reads the file. not sure if this is needed or not since it comes after the actual parsing. 
    fileInput.value = ""; //clears the input file after its done loading
	} else { fileDisplayArea.innerText = "File not supported!" } //if not match, error
});

//section for autocalcs

var level = document.getElementById('Level');
var prof = document.getElementById('ProficiencyBonus');
level.addEventListener('change', function() {
if (level.value >= 1 && level.value <= 4) {
prof.value = 2;
} else if (level.value >= 5 && level.value <= 8) {
prof.value = 3;
} else if (level.value >= 9 && level.value <= 12) {
prof.value = 4;
} else if (level.value >= 13 && level.value <= 16) {
prof.value = 5;
} else if (level.value >= 17 && level.value <= 20) {
prof.value = 6;
} else {prof.value = "";}
});

var AbStr = document.getElementById('Strength');
var AbDex = document.getElementById('Dexterity');
var AbCon = document.getElementById('Constitution');
var AbInt = document.getElementById('Intelligence');
var AbWis = document.getElementById('Wisdom');
var AbCha = document.getElementById('Charisma');
var SavStr = document.getElementById('StrengthSave');
var SavDex = document.getElementById('DexteritySave');
var SavCon = document.getElementById('ConstitutionSave');
var SavInt = document.getElementById('IntelligenceSave');
var SavWis = document.getElementById('WisdomSave');
var SavCha = document.getElementById('CharismaSave');
var SkillAcrobatics  = document.getElementById('Acrobatics');
var SkillAnimalHandling = document.getElementById('AnimalHandling');
var SkillArcana = document.getElementById('Arcana');
var SkillAthletics = document.getElementById('Athletics');
var SkillDeception = document.getElementById('Deception');
var SkillHistory = document.getElementById('History');
var SkillInsight = document.getElementById('Insight');
var SkillIntimidation = document.getElementById('Intimidation');
var SkillInvestigation = document.getElementById('Investigation');
var SkillMedicine = document.getElementById('Medicine');
var SkillNature = document.getElementById('Nature');
var SkillPerception = document.getElementById('Perception');
var SkillPerformance = document.getElementById('Performance');
var SkillPersuasion = document.getElementById('Persuasion');
var SkillReligion = document.getElementById('Religion');
var SkillSleightofHand = document.getElementById('SleightofHand');
var SkillStealth = document.getElementById('Stealth');
var SkillSurvival = document.getElementById('Survival');

var ModArray = [AbStr, AbDex, AbCon, AbInt, AbWis, AbCha, SavStr, SavDex, SavCon, SavInt, SavWis, SavCha, SkillAcrobatics, SkillAnimalHandling, SkillArcana, SkillAthletics, SkillDeception, SkillHistory, SkillInsight, SkillIntimidation, SkillInvestigation, SkillMedicine, SkillNature, SkillPerception, SkillPerformance, SkillPersuasion, SkillReligion, SkillSleightofHand, SkillStealth, SkillSurvival];

var AbilityArray = [AbStr, AbDex, AbCon, AbInt, AbWis, AbCha];
var SaveArray = [SavStr, SavDex, SavCon, SavInt, SavWis, SavCha];
var SkillArray = [SkillAcrobatics, SkillAnimalHandling, SkillArcana, SkillAthletics, SkillDeception, SkillHistory, SkillInsight, SkillIntimidation, SkillInvestigation, SkillMedicine, SkillNature, SkillPerception, SkillPerformance, SkillPersuasion, SkillReligion, SkillSleightofHand, SkillStealth, SkillSurvival];

var scores = {"0":"-6","1":"-5","2":"-4","3":"-4","4":"-3","5":"-3","6":"-2","7":"-2","8":"-1","9":"-1","10":"0","11":"0","12":"1","13":"1","14":"2","15":"2","16":"3","17":"3","18":"4","19":"4","20":"5","21":"5","22":"6","23":"6","24":"7","25":"7","26":"8","27":"8","28":"9","29":"9","30":"10"};

function update() {
	var abilityvalue = event.target.value;
	var abilitymod = document.getElementById(event.target.id + "mod");
  var abilitySave = document.getElementById(event.target.id + "Save");
  var savemod = document.getElementById(event.target.id + "Savemod");
  var init = document.getElementById('Initiative');
  var prof = document.getElementById('ProficiencyBonus');
  if (abilitySave.checked == true) {
  abilitymod.value = scores[abilityvalue];
  savemod.value = parseInt(abilitymod.value) + parseInt(prof.value);
  } else if (scores[abilityvalue] != undefined) {
  abilitymod.value = scores[abilityvalue];
  savemod.value = abilitymod.value;
  } else {abilitymod.value = ""; savemod.value = "";}
  for (var i = 0; i < SkillArray.length; i++) {
  var skillmod = document.getElementById(SkillArray[i].id + "mod");
  var skillability = skillmod.name;
  if (SkillArray[i].checked == true) {
  skillmod.value = parseInt(document.getElementById(skillability + "mod").value) + parseInt(prof.value);
  } else if (document.getElementById(skillability + "mod").value == undefined) {
  skillmod.value = "";
  } else { skillmod.value = document.getElementById(skillability + "mod").value; }
  }
  init.value = document.getElementById('Dexteritymod').value;
}

function updatesaves() {
	var abilitymod = document.getElementById(event.target.id.slice(0, -4) + "mod");
	var savemod = document.getElementById(event.target.id + "mod");
  var prof = document.getElementById('ProficiencyBonus');
  if (event.target.checked == true) {
  savemod.value = parseInt(abilitymod.value) + parseInt(prof.value);
  } else {
  savemod.value = abilitymod.value;
  } 
}

function updateskills() {
	var skillmod = document.getElementById(event.target.id + "mod");
  var abilitymod = document.getElementById(skillmod.getAttribute("name") + "mod");
  if (event.target.checked == true) {
  skillmod.value = parseInt(abilitymod.value) + parseInt(prof.value);
  } else {
  skillmod.value = abilitymod.value;
  } 
}

for (var i = 0; i < AbilityArray.length; i++) {
	AbilityArray[i].addEventListener('change', update);
}

for (var i = 0; i < SaveArray.length; i++) {
	SaveArray[i].addEventListener('change', updatesaves);
}

for (var i = 0; i < SkillArray.length; i++) {
	SkillArray[i].addEventListener('change', updateskills);
}
</script>