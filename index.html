<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <title>Character Sheet</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <name id=name>
        Test name
    </name><br>
    <info id=info>
        Test info
    </info><br>
    <abilityscore id=abilityscore>
        Test abilityscore
    </abilityscore><br>
    <inspiration id=inspiration>
        Test inspiration
    </inspiration><br>
    <proficiencybonus id=proficiencybonus>
        Test proficiencybonus
    </proficiencybonus><br>
    <savingthrows id=savingthrows>
        Test savingthrows
    </savingthrows><br>
    <button type=button id=downloadbutton>Save File</button><br>
    <input type="file" id="fileInput">
</body>

<script>
    var character = 'CharacterName,Level,Class,Race,PlayerName,ExperiencePoints,Alignment,Background,Strength,Dexterity,Constitution,Intelligence,Wisdom,Charisma,Inspiration,ProficiencyBonus,StrengthSave,DexteritySave,ConstitutionSave,IntelligenceSave,WisdomSave,CharismaSave'.split(',');
    var locations = 'name,info,info,info,info,info,info,info,abilityscore,abilityscore,abilityscore,abilityscore,abilityscore,abilityscore,inspiration,proficiencybonus,savingthrows,savingthrows,savingthrows,savingthrows,savingthrows,savingthrows'.split(',');
    var loccount = 0;
    for (var c in character) {
        var newField = document.createElement('input');
        newField.id = character[c];
        newField.classname = character[c];
        newField.placeholder = character[c];
        newField.name = character[c];
        var loc = locations[loccount];
        loccount++
        var elem = document.getElementById(loc);
        elem.appendChild(newField);
        }

document.getElementById("downloadbutton").addEventListener("click", function(){
    var characterfinal = {};
    for (var d in character) {
    		prop = character[d];
        elem = document.getElementById(prop).value;
        characterfinal[prop] = elem;
    }
    var text = JSON.stringify(characterfinal, null, 2);
    var filename = document.getElementById('CharacterName').value;
    download(text, filename);
}, false);

function download(text, filename) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
}


var fileInput = document.getElementById('fileInput');
var fileDisplayArea = document.getElementById('CharacterName');

fileInput.addEventListener('change', function(event) {
    var file = fileInput.files[0];
    var textType = /text.*/;
    if (file.type.match(textType)) {
				var reader = new FileReader();

				reader.onload = function(event) {
                    for (var e in character) {
                        var field = character[e];
                        var loadedcharacter = JSON.parse(reader.result);
                        document.getElementById(field).value = loadedcharacter[field];
                    }
				}
    reader.readAsText(file);	
	} else { fileDisplayArea.innerText = "File not supported!" }
});
</script>